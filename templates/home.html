<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DuFy | Music Streaming</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/727/727245.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
    }
  </style>
</head>

<body class="bg-[#121212] text-white font-sans">
  <!-- Sidebar -->
  <div class="flex h-screen">
    <aside class="w-60 bg-[#0e0e0e] p-5 flex flex-col justify-between">
      <div>
        <h1 class="text-3xl font-semibold text-green-400 mb-8 font-bold">DuFy</h1>
        <nav class="space-y-5 text-gray-300">
          <a href="#" class="flex items-center gap-3 hover:text-green-400 transition font-medium">
            <i class="fas fa-home"></i> <span>Discover</span>
          </a>
          <a href="#" class="flex items-center gap-3 hover:text-green-400 transition font-medium">
            <i class="fas fa-headphones"></i> <span>Genre</span>
          </a>
          <a href="#" class="flex items-center gap-3 hover:text-green-400 transition font-medium">
            <i class="fas fa-chart-line"></i> <span>Top Charts</span>
          </a>
          <a href="#" class="flex items-center gap-3 hover:text-green-400 transition font-medium">
            <i class="fas fa-fire"></i> <span>Trending</span>
          </a>
        </nav>

        <div class="mt-10">
          <h2 class="text-gray-400 uppercase text-sm mb-3 font-semibold">Library</h2>
          <div class="space-y-3 text-gray-300">
            <a href="#" class="hover:text-green-400 flex items-center gap-3 font-medium"><i class="fas fa-heart"></i> Favourites</a>
            <a href="/playlist/" class="flex items-center gap-3 hover:text-green-400 font-medium"><i class="fas fa-list"></i> Playlist</a>
          </div>
        </div>
      </div>

      <div class="text-center text-sm text-gray-400">
        <p class="mb-3 font-light">DuFy Online</p>
      
      </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto">
      <!-- Banner Section -->
      <section class="relative">
        <img src="https://images.unsplash.com/photo-1507525428034-b723cf961d3e" alt="banner"
          class="w-full h-64 object-cover opacity-90">
        <div class="absolute inset-0 flex items-center justify-center">
          <input id="searchInput" type="text" placeholder="Describe your music..."
            class="w-3/4 md:w-1/2 px-6 py-3 rounded-full bg-green-900/70 text-white placeholder-gray-300 focus:outline-none font-medium">
          <button onclick="searchMusic()" class="ml-2 bg-green-600 text-white px-6 py-2 rounded-full hover:bg-green-700 font-semibold">Find Music</button>
        </div>
      </section>

      <!-- Top Picks -->
      <section class="p-6" id="topPicksSection">
        <h2 class="text-xl font-semibold mb-3 text-green-400 font-bold">Top Picks</h2>
        <div id="topPicks" class="flex gap-5 overflow-x-auto pb-4">
          <!-- Manual images with links -->
          <a href="https://youtu.be/r7vgsKtMc2c?si=Qkn_RQ-gavM8hXmJ" target="_blank">
            <img src="static/panchayat.png" class="w-40 h-40 rounded-xl hover:scale-105 transition">
          </a>
          <a href="https://youtu.be/tGv7CUutzqU?si=n85Y8ji-XbQyuIyO" target="_blank">
            <img src="static/aboutyou.png" class="w-40 h-40 rounded-xl hover:scale-105 transition">
          </a>
          <a href="https://youtu.be/uNi5Go5dth8?si=JSTCGOhvUnoLaObK" target="_blank">
            <img src="static/undown.png" class="w-40 h-40 rounded-xl hover:scale-105 transition">
          </a>
          <a href="https://youtu.be/T9Ybj8nrtQw?si=JvfcRfAccpIm3MkI" target="_blank">
            <img src="static/assumptions.png" class="w-40 h-40 rounded-xl hover:scale-105 transition">
          </a>
          <a href="https://youtu.be/viimfQi_pUw?si=INQLeyxMGq2mT8eQ" target="_blank">
            <img src="static/oceaneyes.png" class="w-40 h-40 rounded-xl hover:scale-105 transition">
          </a>
        </div>
      </section>
      <!-- AI Response Section
      <section id="aiResponse" class="text-center px-6 mb-8 hidden">
        <h2 class="text-2xl font-semibold mb-2 text-green-400 font-bold">AI Suggestion</h2>
        <p id="aiResponseText" class="text-gray-300 max-w-2xl mx-auto font-medium">Some of the best matches for you</p>
      </section> -->

      <!-- Latest Album + Editor's Picks -->
      <section class="px-6 grid md:grid-cols-2 gap-10">
        <!-- Latest Album -->
        <div>
          <h2 class="text-lg font-semibold mb-3 text-green-400 font-bold">Best Matches</h2>
          <ul id="latestAlbum" class="space-y-3">
            <!-- Dynamically populated -->
          </ul>
        </div>

        <!-- Editor's Picks -->
        <div>
          <h2 class="text-lg font-semibold mb-3 text-green-400 font-bold">Editor's Picks</h2>
          <ul id="editorsPicks" class="space-y-3">
            <!-- Dynamically populated -->
          </ul>
        </div>
      </section>


      <!-- Footer -->
      <footer class="mt-10 bg-[#0e0e0e] py-10 px-6 text-gray-400 text-sm">
        <div class="grid md:grid-cols-4 gap-8">
          <div>
            <h3 class="text-green-400 text-lg font-semibold mb-3 font-bold">DuFy</h3>
            <p class="font-light">info@Dufyessence.com</p>
            <p class="font-light">+977 9847696889</p>
            <div class="flex gap-3 mt-3 text-white">
              <a href="#" class="hover:text-gray-300"><i class="fab fa-facebook"></i></a>
              <a href="#" class="hover:text-gray-300"><i class="fab fa-twitter"></i></a>
              <a href="#" class="hover:text-gray-300"><i class="fab fa-instagram"></i></a>
            </div>
          </div>

          <div>
            <h4 class="text-white mb-2 font-medium font-semibold">Blog</h4>
            <ul class="space-y-1">
              <li><a href="#" class="hover:text-gray-300 font-light">Company</a></li>
              <li><a href="#" class="hover:text-gray-300 font-light">Career</a></li>
              <li><a href="#" class="hover:text-gray-300 font-light">Mobile</a></li>
              <li><a href="/signup/" class="hover:text-gray-300 font-light">Signup</a></li>
            </ul>
          </div>

          <div>
            <h4 class="text-white mb-2 font-medium font-semibold">About</h4>
            <ul class="space-y-1">
              <li><a href="#" class="hover:text-gray-300 font-light">Contacts</a></li>
              <li><a href="#" class="hover:text-gray-300 font-light">About Us</a></li>
              <li><a href="#" class="hover:text-gray-300 font-light">FAQ</a></li>
              <li><a href="#" class="hover:text-gray-300 font-light">Terms & Services</a></li>
            </ul>
          </div>

          <div>
            <h4 class="text-white mb-2 font-medium font-semibold">Product</h4>
            <ul class="space-y-1">
              <li><a href="#" class="hover:text-gray-300 font-light">Terms of Use</a></li>
              <li><a href="#" class="hover:text-gray-300 font-light">Privacy Policy</a></li>
              <li><a href="#" class="hover:text-gray-300 font-light">Login</a></li>
              <li><a href="#" class="hover:text-gray-300 font-light">Download App</a></li>
            </ul>
          </div>
        </div>
        <div class="text-center mt-8 text-gray-500 font-light">© DuFy 2025 all copyright reserved</div>
      </footer>
    </main>
  </div>

  <script>
    function renderTracks(list, containerId) {
      const container = document.getElementById(containerId);
      if (!container) {
        console.error(`Container ${containerId} not found!`);
        return;
      }

      // Only update topPicks if valid images are provided, otherwise keep manual images
      if (containerId === 'topPicks' && list.length > 0) {
        let hasValidImages = false;
        list.forEach(track => {
          if (track.image) hasValidImages = true;
        });
        if (hasValidImages) {
          container.innerHTML = ""; // Clear only if replacing with new images
          list.forEach(track => {
            if (track.image) {
              const a = document.createElement('a');
              a.href = track.music_link || '#';
              a.target = "_blank";
              a.innerHTML = `<img src="${track.image}" class="w-40 h-40 rounded-xl hover:scale-105 transition">`;
              container.appendChild(a);
            }
          });
        }
      } else if (list.length > 0 && (containerId === 'latestAlbum' || containerId === 'editorsPicks')) {
        container.innerHTML = ""; // Clear for latestAlbum and editorsPicks
        list.forEach(track => {
          const li = document.createElement('li');
          li.className = "flex justify-between hover:bg-[#1e1e1e] p-2 rounded-lg";
          li.innerHTML = `
            <span>${track.music_name} – ${track.artist_name || 'Unknown Artist'}</span>
            <a href="${track.music_link || '#'}" target="_blank"><i class="fas fa-play"></i></a>
          `;
          container.appendChild(li);
        });
      }
    }

    function copyLink(url) {
      navigator.clipboard.writeText(url);
      alert('Link copied!');
    }

    function playTrack(url) {
      if (url && url !== 'No link available') {
        window.open(url, '_blank');
      } else {
        alert('No link available for this track.');
      }
    }

    function setSearch(text) {
      document.getElementById('searchInput').value = text;
      searchMusic();
    }

    function generateAIResponse(query) {
      query = query.toLowerCase();
      let response = "Some of the best matches for you";
      let matchedGenre = "";
      let matchedTags = [];

      if (query.includes("calm") || query.includes("meditative") || query.includes("study")) {
        matchedGenre = "chill";
        matchedTags = ["calm", "meditation"];
      } else if (query.includes("happy") || query.includes("summer") || query.includes("vlog")) {
        matchedGenre = "trending";
        matchedTags = ["fun", "pop"];
      } else if (query.includes("aesthetic") || query.includes("travel") || query.includes("reel")) {
        matchedGenre = "cinematic";
        matchedTags = ["epic", "dramatic"];
      } else if (query.includes("gaming") || query.includes("intense")) {
        matchedGenre = "energetic";
        matchedTags = ["energetic", "dance"];
      } else if (query.includes("romantic") || query.includes("date")) {
        matchedGenre = "romantic";
        matchedTags = ["romantic", "love"];
      } else if (query.includes("edm") || query.includes("high energy")) {
        matchedGenre = "energetic";
        matchedTags = ["energetic", "edm"];
      } else if (query.includes("piano")) {
        matchedGenre = "chill";
        matchedTags = ["piano", "calm"];
      }

      const aiResponseSection = document.getElementById('aiResponse');
      const aiResponseText = document.getElementById('aiResponseText');
      aiResponseText.innerText = response;
      aiResponseSection.classList.remove('hidden');

      return { matchedGenre, matchedTags };
    }

    function searchMusic() {
      const query = document.getElementById('searchInput').value;
      if (!query) return;

      fetch(`/api/recommend/?query=${encodeURIComponent(query)}`)
        .then(response => response.json())
        .then(data => {
          console.log('API Response:', data);
          if (data.recommendations && data.recommendations.length > 0) {
            renderTracks(data.recommendations.slice(0, 5), 'topPicks'); // First 5 for Top Picks
            renderTracks(data.recommendations.slice(0, 4), 'latestAlbum'); // First 4 for Latest Album
            renderTracks(data.recommendations.slice(4, 8), 'editorsPicks'); // Next 4 for Editor's Picks
            generateAIResponse(query);
          } else {
            console.warn('No recommendations found, keeping manual topPicks images.');
            renderTracks([], 'latestAlbum');
            renderTracks([], 'editorsPicks');
          }
        })
        .catch(error => {
          console.error('Error fetching recommendations:', error);
          renderTracks([], 'latestAlbum');
          renderTracks([], 'editorsPicks');
        });
    }

    // Initial render with top 10 songs from server
    document.addEventListener('DOMContentLoaded', () => {
      console.log("DOM fully loaded, checking topPicksSection...");
      const topPicksSection = document.getElementById('topPicksSection');
      if (topPicksSection) {
        console.log("topPicksSection found:", topPicksSection);
      } else {
        console.error("topPicksSection not found in DOM!");
      }
      fetch('/api/recommend/?query=popular')
        .then(response => response.json())
        .then(data => {
          console.log('Initial API Response:', data);
          if (data.recommendations && data.recommendations.length > 0) {
            renderTracks(data.recommendations.slice(0, 5), 'topPicks'); // First 5 for Top Picks
            renderTracks(data.recommendations.slice(0, 4), 'latestAlbum'); // First 4 for Latest Album
            renderTracks(data.recommendations.slice(4, 8), 'editorsPicks'); // Next 4 for Editor's Picks
          } else {
            console.warn('No initial recommendations, keeping manual topPicks images.');
            renderTracks([], 'latestAlbum');
            renderTracks([], 'editorsPicks');
          }
        })
        .catch(error => {
          console.error('Error fetching initial tracks:', error);
          renderTracks([], 'latestAlbum');
          renderTracks([], 'editorsPicks');
        });
    });
  </script>
</body>
</html>